@using hthservices.Utils;
@using hthservices.Models.Website;
@{
    ProgrammingContent programmingContent = ViewBag.Content;
    List<ProgrammingContent> relatedProgrammingContents = ViewBag.RelatedContents;
    if (programmingContent != null)
    {
        ViewBag.Title = programmingContent.Title;
        ViewBag.Keywords = programmingContent.Keywords;
        ViewBag.Description = programmingContent.ShortContent;
    }
}
<div class="content sing">
    <div class="container">
        <div class="content-text cnt-txt">
            <div class="title">
                @if (programmingContent == null)
                {
                    <div>
                        <div class="some-title">
                            <h3>Bài viết không tồn tại</h3>
                        </div>
                    </div>
                }
                else
                {
                    <div>
                        <div class="some-title">
                            <h1>@programmingContent.Title</h1>
                        </div>
                        <div class="john">
                            <p><span>@programmingContent.GetPublishedDateToShow()</span></p>
                        </div>
                        <div class="clearfix"> </div>
                        <div class="" style="padding-top: 10px; padding-bottom: 50px;">
                            @*@if (!string.IsNullOrWhiteSpace(programmingContent.ImageUrl))
                                {
                                    <img class="img" src="@programmingContent.ImageUrl" alt=" " />
                                }*@
                            <div class="vel" style="padding-bottom: 20px;font-weight: 600;">
                                @programmingContent.ShortContent
                            </div>
                            <div class="Sed">
                                @Html.Raw(programmingContent.Content)
                            </div>
                        </div>
                        <div class="border">
                            <p>&nbsp;</p>
                        </div>
                        <div class="related-posts">
                            <h2>Bài Viết Cùng Chuyên Mục</h2>
                            @if (relatedProgrammingContents != null)
                            {
                                for (int i = 0; i < relatedProgrammingContents.Count; i++)
                                {
                                    var relatedContent = relatedProgrammingContents.ElementAt(i);
                                    if (i % 4 == 0)
                                    {
                            @:<div class="related-posts-grids">
                                    }
                            <div class="related-posts-grid">
                                <a href="@Url.RouteUrl("programmingcontent", new { category_name=Url.ToFriendlyUrl(relatedContent.Category.Name), content_name=Url.ToFriendlyUrl(relatedContent.Title), id=relatedContent.Id })"><img class="img" src="@(string.IsNullOrWhiteSpace(relatedContent.ImageUrl) ? string.Format("/home/GenerateImage/?text={0}", relatedContent.TextAvatar) : relatedContent.ImageUrl)" alt="@relatedContent.Title" title="@relatedContent.Title" /></a>
                                <h4><a href="@Url.RouteUrl("ProgrammingContent", new { category_name = Url.ToFriendlyUrl(relatedContent.Category.Name), content_name = Url.ToFriendlyUrl(relatedContent.Title), id = relatedContent.Id })">@relatedContent.Title</a></h4>
                                <p>
                                    @relatedContent.ShortContent
                                </p>
                            </div>
                                    if ((i % 4 == 0 && i != 0) || (i == relatedProgrammingContents.Count - 1))
                                    {
                            @: </div>
                            <div class="clearfix"> </div>
                                    }
                                }
                            }
                        </div>
                    </div>
                    <div class="clearfix"> </div>
                    <div class="comments">
                        <h2>Phản Hồi</h2>
                        <div id="comments">
                            @foreach (ProgrammingComment comment in programmingContent.Comments)
                            {
                                <div class="comments-info">
                                    <div class="cmnt-icon-left">
                                        <img src="~/Web/images/icon3.png" alt="" />
                                    </div>
                                    <div class="cmnt-icon-right">
                                        <p>@comment.GetUpdatedDateToShow()</p>
                                        <p><a href="#">@comment.Name</a></p>
                                        <p class="cmmnt">
                                            @Html.Raw(@comment.Message)
                                        </p>
                                    </div>
                                    <div class="clearfix"> </div>
                                    <div class="aliqua">
                                        <!--<a href="#">Reply</a>-->
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                    <div class="consequat">
                        <h2>Viết Phản Hồi</h2>
                        <input type="text" value="Name" id="Name" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = 'Name';}" required="">
                        <input type="email" value="Email" id="Email" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = 'Email';}" required="">
                        <textarea name="commenteditor" id="Message" type="text" required=""></textarea>
                        <input type="button" value="Phản Hồi" onclick="saveComment()">
                    </div>
                }
            </div>
            @Html.Action("RightProgrammingPartial", "Programming")
        </div>
    </div>
</div>
@section Scripts{
    @if (programmingContent != null)
    {
        <script src="~/Scripts/bower_components/ckeditor-4.5.11/ckeditor.js"></script>
        <script>
            // Replace the <textarea id="editor1"> with a CKEditor
            // instance, using default configuration.
            CKEDITOR.replace('commenteditor', {
                toolbar: [
                            ['Cut', 'Copy', 'Paste', 'PasteText', 'PasteFromWord', '-', 'Undo', 'Redo'],
                            ['Link', 'Unlink', 'Anchor'],
                            ['Smiley', 'SpecialChar'],
                            ['TextColor', 'BGColor'],
                            '/',
                            ['Bold', 'Italic', 'Underline', 'Strike', 'Subscript', 'Superscript', '-', 'RemoveFormat'],
                            ['Styles', 'Format', 'Font', 'FontSize']

                ],
            });

            saveComment = function()
            {
                var name = $("#Name").val();
                var email = $("#Email").val();
                var message = CKEDITOR.instances.Message.getData();
                if(typeof(name)=="undefined" || name=="" || typeof(email)=="undefined" || email=="" || typeof(message)=="undefined" || message=="")
                {
                    alert('Tất cả các trường phải được nhập');
                }else{
                    $.post("/api/AdministratorApi/SaveComment/", { Name: name, Email: email, Message:message, ContentId: '@programmingContent.Id', IsDisplay: 1})
                          .done(function (data) {
                              var htmlVal = '<div class="comments-info"><div class="cmnt-icon-left"><img src="/Web/images/icon3.png" alt="" /></div>';
                              htmlVal += '<div class="cmnt-icon-right"> <p>Just Now</p>';
                              htmlVal += '<p><a href="#">'+name+'</a></p>';
                              htmlVal += '<p class="cmmnt">'+message+' </p>';
                              htmlVal += '</div>';
                              htmlVal += '<div class="clearfix"> </div><div class="aliqua"><a href="#">Reply</a></div>';
                              htmlVal += '</div>';
                              $("#comments").append(htmlVal);
                          });
                }
            }

        </script>
    }
}
